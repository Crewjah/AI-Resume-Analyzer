<!DOCTYPE html>
<html>
<head>
    <title>Quick Test - Resume Analyzer</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #1a1a2e; color: #eee; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #2e7d32; }
        .error { background: #c62828; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        input[type="file"] { margin: 10px 0; }
    </style>
</head>
<body>
    <h1>ðŸ§ª Direct Backend Test</h1>
    <p>API URL: <strong id="api-url">http://127.0.0.1:5000</strong></p>
    
    <button onclick="testHealth()">Test Backend Health</button>
    <button onclick="testAnalyze()">Test Resume Analysis</button>
    
    <div>
        <h3>Upload Resume to Test:</h3>
        <input type="file" id="fileInput" accept=".pdf,.docx,.txt">
        <button onclick="uploadFile()">Upload & Analyze</button>
    </div>
    
    <div id="results"></div>

    <script>
        const API = 'http://127.0.0.1:5000';
        const results = document.getElementById('results');
        
        function showResult(msg, isError = false) {
            const div = document.createElement('div');
            div.className = 'status ' + (isError ? 'error' : 'success');
            div.innerHTML = msg;
            results.prepend(div);
        }
        
        async function testHealth() {
            try {
                showResult('Testing backend health...', false);
                const res = await fetch(`${API}/health`);
                const data = await res.json();
                showResult('âœ… Backend Health: ' + JSON.stringify(data), false);
            } catch (err) {
                showResult('âŒ Health Check Failed: ' + err.message, true);
            }
        }
        
        async function testAnalyze() {
            try {
                showResult('Creating test resume...', false);
                const testContent = 'John Doe\nSoftware Engineer\n\nSkills: Python, JavaScript, React, Node.js, AWS, Docker, Kubernetes\n\nExperience:\n- 5 years as Full Stack Developer\n- Built scalable web applications\n- Led team of developers\n\nEducation:\nBS Computer Science 2018';
                
                const blob = new Blob([testContent], { type: 'text/plain' });
                const formData = new FormData();
                formData.append('file', blob, 'test_resume.txt');
                
                showResult('Sending to backend...', false);
                const res = await fetch(`${API}/analyze`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await res.json();
                showResult('âœ… Analysis Complete: ATS Score=' + data.ats_score + ', Skills=' + data.skill_count, false);
                showResult('Full response: ' + JSON.stringify(data, null, 2), false);
            } catch (err) {
                showResult('âŒ Analysis Failed: ' + err.message, true);
            }
        }
        
        async function uploadFile() {
            const fileInput = document.getElementById('fileInput');
            if (!fileInput.files.length) {
                showResult('âŒ Please select a file first', true);
                return;
            }
            
            try {
                const formData = new FormData();
                formData.append('file', fileInput.files[0]);
                
                showResult('Uploading ' + fileInput.files[0].name + '...', false);
                const res = await fetch(`${API}/analyze`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await res.json();
                if (data.error) {
                    showResult('âŒ Error: ' + data.error, true);
                } else {
                    showResult('âœ… Success! ATS Score: ' + data.ats_score + '%, Skills: ' + data.skill_count, false);
                    showResult('Details: ' + JSON.stringify(data, null, 2), false);
                }
            } catch (err) {
                showResult('âŒ Upload Failed: ' + err.message, true);
            }
        }
        
        // Auto-test on load
        window.onload = () => {
            testHealth();
        };
    </script>
</body>
</html>
